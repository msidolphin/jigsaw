!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("jigasw",[],t):"object"==typeof exports?exports.jigasw=t():e.jigasw=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(1),n=(i.n(s),i(2));t.default=n.a},function(e,t){},function(e,t,i){"use strict";var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();var n=42,a=10,r=310,h=155,o=Math.PI,l=62,c=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaultOpts={success:null,fail:null,autoInit:!0},this.opts=Object.assign({},this.defaultOpts,i),this.el=t,this.success=this.opts.success,this.fail=this.opts.fail,this.isSuccess=!1,this.isStart=!1,this.originX=0,this.originY=0,this.pageX=0,this.pageY=0,this.trail=[],this.opts.autoInit&&(this.initDOM(),this.initImg(),this.draw(),this.bindEvents())}return s(e,[{key:"init",value:function(){this.initDOM(),this.initImg(),this.draw(),this.bindEvents()}},{key:"createCanvas",value:function(e,t){var i=this.createElement("canvas");return i.width=e,i.height=t,i}},{key:"createElement",value:function(e){return document.createElement(e)}},{key:"createImg",value:function(e){var t=this,i=this.createElement("img");return i.crossOrigin="Anonymous",i.onload=e,i.onerror=function(){i.src=t.getRandomImg()},i.src=this.getRandomImg(),i}},{key:"getRandomImg",value:function(){return"https://picsum.photos/300/150/?image="+this.getRandomNumberByRange(0,100)}},{key:"getRandomNumberByRange",value:function(e,t){return Math.round(Math.random()*(t-e)+e)}},{key:"drawCard",value:function(e,t,i,s){e.beginPath(),e.moveTo(i,s),e.lineTo(i+21,s),e.arc(i+21,s-a+2,a,0,2*o),e.lineTo(i+21,s),e.lineTo(i+n,s),e.lineTo(i+n,s+21),e.arc(i+n+a-2,s+21,a,0,2*o),e.lineTo(i+n,s+21),e.lineTo(i+n,s+n),e.lineTo(i,s+n),e.lineTo(i,s),e.fillStyle="#fff",e[t](),e.beginPath(),e.arc(i,s+21,a,1.5*o,.5*o),e.globalCompositeOperation="xor",e.fill()}},{key:"addClass",value:function(e,t){e.classList.add(t)}},{key:"removeClass",value:function(e,t){e.classList.remove(t)}},{key:"sum",value:function(e,t){return e+t}},{key:"square",value:function(e){return e*e}},{key:"initDOM",value:function(){var e=this.createCanvas(r,h),t=e.cloneNode(!0),i=this.createElement("div"),s=this.createElement("div"),n=this.createElement("div"),a=this.createElement("div"),o=this.createElement("span"),l=this.createElement("span");t.className="block",i.className="sliderContainer",s.className="refreshIcon",n.className="sliderMask",a.className="slider",o.className="sliderIcon",l.innerHTML="向右滑动滑块填充拼图",l.className="sliderText";var c=this.el;c.appendChild(e),c.appendChild(s),c.appendChild(t),a.appendChild(o),n.appendChild(a),i.appendChild(n),i.appendChild(l),c.appendChild(i),Object.assign(this,{canvas:e,block:t,sliderContainer:i,refreshIcon:s,slider:a,sliderMask:n,sliderIcon:o,text:l,canvasCtx:e.getContext("2d"),blockCtx:t.getContext("2d")})}},{key:"initImg",value:function(){var e=this,t=this.createImg(function(){e.canvasCtx.drawImage(t,0,0,r,h),e.blockCtx.drawImage(t,0,0,r,h);var i=e.y-20+2,s=e.blockCtx.getImageData(e.x,i,l,l);e.block.width=l,e.blockCtx.putImageData(s,0,i)});this.img=t}},{key:"draw",value:function(){this.x=this.getRandomNumberByRange(72,238),this.y=this.getRandomNumberByRange(30,83),this.drawCard(this.canvasCtx,"fill",this.x,this.y),this.drawCard(this.blockCtx,"clip",this.x,this.y)}},{key:"clean",value:function(){this.canvasCtx.clearRect(0,0,r,h),this.blockCtx.clearRect(0,0,r,h),this.block.width=r}},{key:"handleStart",value:function(e){this.originX=e.x,this.originY=e.y,this.isStart=!0}},{key:"handleMove",value:function(e){if(!this.isStart||this.isSuccess)return!1;this.pageX=e.x,this.pageY=e.y;var t=this.pageX-this.originX,i=this.pageY-this.originY;if(t<0||t+38>=r)return!1;var s=t>270?270:t,n=!1;if(s>=270&&(n=!0),this.slider.style.left=s+"px",this.addClass(this.sliderContainer,"sliderContainer_active"),this.sliderMask.style.width=s+1+"px",this.trail.push(i),!n){var a=250/270*t;this.block.style.left=a+"px"}}},{key:"handleEnd",value:function(e){var t=this;if(!this.isStart)return!1;if(this.isStart=!1,e.x==this.originX)return!1;this.pageX=e.x,this.removeClass(this.sliderContainer,"sliderContainer_active");var i=this.verify(),s=i.spliced,n=i.pass;s?n?(this.addClass(this.sliderContainer,"sliderContainer_success"),this.isSuccess=!0,this.el.removeChild(this.refreshIcon),this.success&&this.success()):(this.addClass(this.sliderContainer,"sliderContainer_fail"),this.text.innerHTML="再试一次",this.reset()):(this.addClass(this.sliderContainer,"sliderContainer_fail"),this.fail&&this.fail(),setTimeout(function(){t.reset()},1e3))}},{key:"getTouchEvent",value:function(e){return!(!e.touches||!e.touches.length)&&{x:e.touches[0].pageX,y:e.touches[0].pageY}}},{key:"bindEvents",value:function(){var e=this;this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleStart4Touch=function(t){t.stopPropagation(),t.preventDefault();var i=e.getTouchEvent(t);i&&e.handleStart(i)},this.handleMove4Touch=function(t){t.stopPropagation(),t.preventDefault();var i=e.getTouchEvent(t);i&&e.handleMove(i)},this.handleEnd4Touch=function(t){t.stopPropagation(),t.preventDefault(),e.handleEnd({x:e.pageX,y:e.pageY})},this.el.onselectstart=function(){return!1},this.refreshIcon.onclick=function(){e.reset()},this.slider.addEventListener("mousedown",this.handleStart),this.slider.addEventListener("mousemove",this.handleMove),this.slider.addEventListener("mouseup",this.handleEnd),this.slider.addEventListener("touchstart",this.handleStart4Touch),this.slider.addEventListener("touchmove",this.handleMove4Touch),this.slider.addEventListener("touchend",this.handleEnd4Touch)}},{key:"verify",value:function(){var e=this.trail,t=e.reduce(this.sum)/e.length,i=e.map(function(e){return e-t}),s=Math.sqrt(i.map(this.square).reduce(this.sum)/e.length),n=parseInt(this.block.style.left);return{spliced:Math.abs(n-this.x)<10,pass:t!==s}}},{key:"reset",value:function(){this.sliderContainer.className="sliderContainer",this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.isSuccess=!1,this.originX=0,this.originY=0,this.pageX=0,this.pageY=0,this.trail=[],this.clean(),this.img.src=this.getRandomImg(),this.draw()}},{key:"destroy",value:function(){this.slider&&this.slider.removeEventListener&&(this.slider.removeEventListener("mousedown",this.handleStart),this.slider.removeEventListener("mousemove",this.handleMove),this.slider.removeEventListener("mouseup",this.handleEnd),this.slider.removeEventListener("touchstart",this.handleStart4Touch),this.slider.removeEventListener("touchmove",this.handleMove4Touch),this.slider.removeEventListener("touchend",this.handleEnd4Touch))}}]),e}();t.a=c}])});