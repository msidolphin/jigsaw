!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("jigasw",[],t):"object"==typeof exports?exports.jigasw=t():e.jigasw=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),s=(n.n(i),n(2));t.default=s.a},function(e,t){},function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var s=42,a=10,r=310,l=155,o=Math.PI,c=62,u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaultOpts={success:null,fail:null,autoInit:!0},this.opts=Object.assign({},this.defaultOpts,n),this.el=t,this.success=this.opts.success,this.fail=this.opts.fail,this.isSuccess=!1,this.opts.autoInit&&(this.initDOM(),this.initImg(),this.draw(),this.bindEvents())}return i(e,[{key:"init",value:function(){this.initDOM(),this.initImg(),this.draw(),this.bindEvents()}},{key:"createCanvas",value:function(e,t){var n=this.createElement("canvas");return n.width=e,n.height=t,n}},{key:"createElement",value:function(e){return document.createElement(e)}},{key:"createImg",value:function(e){var t=this,n=this.createElement("img");return n.crossOrigin="Anonymous",n.onload=e,n.onerror=function(){n.src=t.getRandomImg()},n.src=this.getRandomImg(),n}},{key:"getRandomImg",value:function(){return"https://picsum.photos/300/150/?image="+this.getRandomNumberByRange(0,100)}},{key:"getRandomNumberByRange",value:function(e,t){return Math.round(Math.random()*(t-e)+e)}},{key:"drawCard",value:function(e,t,n,i){e.beginPath(),e.moveTo(n,i),e.lineTo(n+21,i),e.arc(n+21,i-a+2,a,0,2*o),e.lineTo(n+21,i),e.lineTo(n+s,i),e.lineTo(n+s,i+21),e.arc(n+s+a-2,i+21,a,0,2*o),e.lineTo(n+s,i+21),e.lineTo(n+s,i+s),e.lineTo(n,i+s),e.lineTo(n,i),e.fillStyle="#fff",e[t](),e.beginPath(),e.arc(n,i+21,a,1.5*o,.5*o),e.globalCompositeOperation="xor",e.fill()}},{key:"addClass",value:function(e,t){e.classList.add(t)}},{key:"removeClass",value:function(e,t){e.classList.remove(t)}},{key:"sum",value:function(e,t){return e+t}},{key:"square",value:function(e){return e*e}},{key:"initDOM",value:function(){var e=this.createCanvas(r,l),t=e.cloneNode(!0),n=this.createElement("div"),i=this.createElement("div"),s=this.createElement("div"),a=this.createElement("div"),o=this.createElement("span"),c=this.createElement("span");t.className="block",n.className="sliderContainer",i.className="refreshIcon",s.className="sliderMask",a.className="slider",o.className="sliderIcon",c.innerHTML="向右滑动滑块填充拼图",c.className="sliderText";var u=this.el;u.appendChild(e),u.appendChild(i),u.appendChild(t),a.appendChild(o),s.appendChild(a),n.appendChild(s),n.appendChild(c),u.appendChild(n),Object.assign(this,{canvas:e,block:t,sliderContainer:n,refreshIcon:i,slider:a,sliderMask:s,sliderIcon:o,text:c,canvasCtx:e.getContext("2d"),blockCtx:t.getContext("2d")})}},{key:"initImg",value:function(){var e=this,t=this.createImg(function(){e.canvasCtx.drawImage(t,0,0,r,l),e.blockCtx.drawImage(t,0,0,r,l);var n=e.y-20+2,i=e.blockCtx.getImageData(e.x,n,c,c);e.block.width=c,e.blockCtx.putImageData(i,0,n)});this.img=t}},{key:"draw",value:function(){this.x=this.getRandomNumberByRange(72,238),this.y=this.getRandomNumberByRange(30,83),this.drawCard(this.canvasCtx,"fill",this.x,this.y),this.drawCard(this.blockCtx,"clip",this.x,this.y)}},{key:"clean",value:function(){this.canvasCtx.clearRect(0,0,r,l),this.blockCtx.clearRect(0,0,r,l),this.block.width=r}},{key:"bindEvents",value:function(){var e=this;this.el.onselectstart=function(){return!1},this.refreshIcon.onclick=function(){e.reset()};var t=void 0,n=void 0,i=[],s=!1;this.slider.addEventListener("mousedown",function(e){t=e.x,n=e.y,s=!0}),document.addEventListener("mousemove",function(a){if(!s||e.isSuccess)return!1;var l=a.x-t,o=a.y-n;if(l<0||l+38>=r)return!1;var c=l>270?270:l,u=!1;if(c>=270&&(u=!0),e.slider.style.left=c+"px",e.addClass(e.sliderContainer,"sliderContainer_active"),e.sliderMask.style.width=c+1+"px",i.push(o),!u){var d=250/270*l;e.block.style.left=d+"px"}}),document.addEventListener("mouseup",function(n){if(!s)return!1;if(s=!1,n.x==t)return!1;e.removeClass(e.sliderContainer,"sliderContainer_active"),e.trail=i;var a=e.verify(),r=a.spliced,l=a.TuringTest;r?l?(e.addClass(e.sliderContainer,"sliderContainer_success"),e.isSuccess=!0,e.el.removeChild(e.refreshIcon),e.success&&e.success()):(e.addClass(e.sliderContainer,"sliderContainer_fail"),e.text.innerHTML="再试一次",e.reset()):(e.addClass(e.sliderContainer,"sliderContainer_fail"),e.fail&&e.fail(),setTimeout(function(){e.reset()},1e3))})}},{key:"verify",value:function(){var e=this.trail,t=e.reduce(this.sum)/e.length,n=e.map(function(e){return e-t}),i=Math.sqrt(n.map(this.square).reduce(this.sum)/e.length),s=parseInt(this.block.style.left);return{spliced:Math.abs(s-this.x)<10,TuringTest:t!==i}}},{key:"reset",value:function(){this.sliderContainer.className="sliderContainer",this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.isSuccess=!1,this.clean(),this.img.src=this.getRandomImg(),this.draw()}}]),e}();t.a=u}])});